<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线音频处理协议详解 - 计算机音频处理学习指南</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <nav>
        <div class="container">
            <ul>
                <li><a href="index.html">音频基础</a></li>
                <li><a href="algorithms.html">常用算法</a></li>
                <li><a href="ai-audio.html">AI音频处理</a></li>
                <li><a href="streaming-protocols.html">在线音频协议</a></li>
                <li><a href="python-examples.html">Python示例</a></li>
                <li><a href="golang-examples.html">Golang示例</a></li>
                <li><a href="audio-terms.html">音频术语</a></li>
                <li><a href="ffmpeg-audio.html">FFmpeg 处理</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <section class="section">
            <h2>在线音频传输概述</h2>
            <p>现代音乐和音频网站采用多种协议来实现高效的在线音频传输。每种协议都有其特定的应用场景、优缺点和技术特点。</p>
            
            <div class="content-block">
                <h4>主要应用场景</h4>
                <ul>
                    <li><strong>音乐流媒体</strong>：Spotify、Apple Music、网易云音乐</li>
                    <li><strong>语音通话</strong>：Zoom、微信语音、Discord</li>
                    <li><strong>直播平台</strong>：Twitch、斗鱼直播</li>
                    <li><strong>在线广播</strong>：喜马拉雅、Podcast</li>
                    <li><strong>游戏语音</strong>：TeamSpeak、Discord游戏</li>
                </ul>
            </div>
        </section>

        <section class="section">
            <h2>HTTP渐进式下载</h2>
            
            <div class="algorithm-card">
                <h4>原理说明</h4>
                <p>HTTP渐进式下载是最基础的在线音频传输方式，客户端直接从HTTP服务器下载音频文件，边下载边播放，无需等待完整下载。</p>
            </div>

            <div class="content-block">
                <h4>工作流程</h4>
                <ol>
                    <li>客户端发送HTTP GET请求</li>
                    <li>服务器返回音频文件（Content-Length或Chunked）</li>
                    <li>浏览器/播放器开始下载并缓存</li>
                    <li>当缓存足够播放时开始解码播放</li>
                    <li>继续下载直到完成或用户停止</li>
                </ol>
            </div>

            <div class="info-box">
                <h4>优缺点分析</h4>
                <table>
                    <thead>
                        <tr>
                            <th>优点</th>
                            <th>缺点</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>实现简单</td>
                            <td>无法适应网络波动</td>
                        </tr>
                        <tr>
                            <td>兼容性好</td>
                            <td>不支持直播</td>
                        </tr>
                        <tr>
                            <td>无需专用服务器</td>
                            <td>无法快进到未下载部分</td>
                        </tr>
                        <tr>
                            <td>支持断点续传</td>
                            <td>首屏加载时间长</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="section">
            <h2>HLS - HTTP实时流媒体协议</h2>
            
            <div class="algorithm-card">
                <h4>协议概述</h4>
                <p>HLS (HTTP Live Streaming) 是苹果公司开发的自适应流媒体协议，将大文件分割成多个小文件片段，支持多码率自适应。</p>
            </div>

            <div class="content-block">
                <h4>HLS核心组件</h4>
                <ul>
                    <li><strong>Playlist (.m3u8)</strong>：索引文件，列出所有分片</li>
                    <li><strong>Segment (.ts)</strong>：媒体分片，通常10秒一段</li>
                    <li><strong>Master Playlist</strong>：主索引，包含多个码率版本</li>
                </ul>
            </div>

            <div class="content-block">
                <h4>m3u8 Playlist示例</h4>
                <div class="code-block">
                    <pre>#EXTM3U
#EXT-X-VERSION:3
#EXT-X-TARGETDURATION:10
#EXT-X-MEDIA-SEQUENCE:0

#EXTINF:10.0,
segment0.ts
#EXTINF:10.0,
segment1.ts
#EXTINF:9.5,
segment2.ts

#EXT-X-ENDLIST</pre>
                </div>
            </div>

            <div class="info-box">
                <h4>HLS关键特性</h4>
                <table>
                    <thead>
                        <tr>
                            <th>特性</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>自适应码率</td>
                            <td>根据网络自动切换质量</td>
                        </tr>
                        <tr>
                            <td>HTTPS支持</td>
                            <td>支持加密传输</td>
                        </tr>
                        <tr>
                            <td>支持DRM</td>
                            <td>可集成FairPlay保护</td>
                        </tr>
                        <tr>
                            <td>低延迟HLS</td>
                            <td>LL-HLS减少到2秒延迟</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="section">
            <h2>DASH - 动态自适应流媒体</h2>
            
            <div class="algorithm-card">
                <h4>协议概述</h4>
                <p>DASH (Dynamic Adaptive Streaming over HTTP) 是国际标准组织ISO制定的开放标准，与HLS类似但更加灵活，广泛应用于YouTube、Netflix等平台。</p>
            </div>

            <div class="content-block">
                <h4>DASH vs HLS对比</h4>
                <table>
                    <thead>
                        <tr>
                            <th>特性</th>
                            <th>DASH</th>
                            <th>HLS</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>标准组织</td>
                            <td>ISO/IEC</td>
                            <td>Apple</td>
                        </tr>
                        <tr>
                            <td>索引格式</td>
                            <td>XML (MPD)</td>
                            <td>Playlist (.m3u8)</td>
                        </tr>
                        <tr>
                            <td>DRM支持</td>
                            <td>通用加密 (CENC)</td>
                            <td>FairPlay</td>
                        </tr>
                        <tr>
                            <td>浏览器支持</td>
                            <td>MSE原生支持</td>
                            <td>需特殊支持</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="content-block">
                <h4>MPD文件示例 - 点播</h4>
                <div class="code-block">
                    <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;MPD xmlns="urn:mpeg:dash:schema:mpd:2011"
     profiles="urn:mpeg:dash:profile:isoff-on-demand:2011"
     type="static"
     mediaPresentationDuration="PT4M30.000S"
     minBufferTime="PT2.000S"&gt;
    
    &lt;Period id="main-content" start="PT0.000S"&gt;
        
        &lt;AdaptationSet id="audio-1" group="2"
                       contentType="audio"
                       lang="zh-CN"
                       mimeType="audio/mp4"&gt;
            
            &lt;Representation id="audio-128kbps" bandwidth="128000" 
                           audioSamplingRate="48000" numChannels="2"&gt;
                &lt;BaseURL&gt;audio/&lt;/BaseURL&gt;
                &lt;SegmentList duration="4000" timescale="1000"&gt;
                    &lt;Initialization sourceURL="audio-init.mp4"/&gt;
                    &lt;SegmentURL media="audio-seg1.m4s" duration="4000"/&gt;
                    &lt;SegmentURL media="audio-seg2.m4s" duration="4000"/&gt;
                &lt;/SegmentList&gt;
            &lt;/Representation&gt;
            
            &lt;Representation id="audio-256kbps" bandwidth="256000" 
                           audioSamplingRate="48000" numChannels="2"&gt;
                &lt;BaseURL&gt;audio/&lt;/BaseURL&gt;
                &lt;SegmentList duration="4000" timescale="1000"&gt;
                    &lt;Initialization sourceURL="audio-hq-init.mp4"/&gt;
                    &lt;SegmentURL media="audio-hq-seg1.m4s" duration="4000"/&gt;
                &lt;/SegmentList&gt;
            &lt;/Representation&gt;
        &lt;/AdaptationSet&gt;
    &lt;/Period&gt;
&lt;/MPD&gt;</pre>
                </div>
            </div>

            <div class="content-block">
                <h4>MPD字段说明</h4>
                <table>
                    <thead>
                        <tr>
                            <th>字段</th>
                            <th>说明</th>
                            <th>示例值</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>profiles</td>
                            <td>支持的DASH profile</td>
                            <td>urn:mpeg:dash:profile:isoff-on-demand:2011</td>
                        </tr>
                        <tr>
                            <td>type</td>
                            <td>类型：static/live</td>
                            <td>static</td>
                        </tr>
                        <tr>
                            <td>mediaPresentationDuration</td>
                            <td>总时长</td>
                            <td>PT4M30.000S</td>
                        </tr>
                        <tr>
                            <td>AdaptationSet</td>
                            <td>自适应集</td>
                            <td>contentType="audio"</td>
                        </tr>
                        <tr>
                            <td>Representation</td>
                            <td>码率版本</td>
                            <td>bandwidth等属性</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="content-block">
                <h4>直播场景MPD示例</h4>
                <div class="code-block">
                    <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;MPD xmlns="urn:mpeg:dash:schema:mpd:2011"
     profiles="urn:mpeg:dash:profile:isoff-live:2011"
     type="live"
     availabilityStartTime="2024-01-15T10:00:00.000Z"
     minBufferTime="PT4.000S"
     minUpdatePeriod="PT1.000S"&gt;

    &lt;Period id="live-stream" start="PT0.000S"&gt;
        &lt;AdaptationSet id="audio-live" group="2"
                       contentType="audio"
                       mimeType="audio/mp4"&gt;
            
            &lt;Representation id="live-audio" bandwidth="128000"
                           audioSamplingRate="48000" numChannels="2"&gt;
                &lt;BaseURL&gt;live/&lt;/BaseURL&gt;
                &lt;SegmentTemplate media="audio-seg-$Time$.m4s"
                                initialization="audio-init.mp4"
                                timescale="48000"&gt;
                    &lt;SegmentTimeline&gt;
                        &lt;S t="0" d="96000" r="10"/&gt;
                    &lt;/SegmentTimeline&gt;
                &lt;/SegmentTemplate&gt;
            &lt;/Representation&gt;
        &lt;/AdaptationSet&gt;
    &lt;/Period&gt;
&lt;/MPD&gt;</pre>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>RTMP - 实时消息传输协议</h2>
            
            <div class="algorithm-card">
                <h4>协议概述</h4>
                <p>RTMP (Real-Time Messaging Protocol) 是Adobe开发的实时传输协议，最初用于Flash播放器，曾是直播领域的主流协议。</p>
            </div>

            <div class="content-block">
                <h4>RTMP工作模式</h4>
                <ul>
                    <li><strong>RTMP</strong>：默认端口1935，基于TCP</li>
                    <li><strong>RTMPT</strong>：HTTP封装，穿透防火墙</li>
                    <li><strong>RTMPS</strong>：基于TLS/SSL加密</li>
                    <li><strong>RTMPE</strong>：Adobe加密版本</li>
                </ul>
            </div>

            <div class="content-block">
                <h4>RTMP URL格式</h4>
                <div class="code-block">
                    <pre>rtmp://[server]:[port]/[app]/[stream_name]

示例：
rtmp://live.example.com:1935/live/stream_key
rtmps://live.example.com:443/live/stream_key</pre>
                </div>
            </div>

            <div class="info-box warning">
                <h4>RTMP现状说明</h4>
                <ul>
                    <li>Adobe已停止Flash支持，RTMP逐渐被淘汰</li>
                    <li>现在主要用于推流端（OBS→服务器）</li>
                    <li>播放端通常需要转码为HLS/DASH</li>
                </ul>
            </div>
        </section>

        <section class="section">
            <h2>WebRTC - 网页实时通信</h2>
            
            <div class="algorithm-card">
                <h4>协议概述</h4>
                <p>WebRTC (Web Real-Time Communication) 是W3C制定的开放标准，支持浏览器之间进行点对点实时音视频通信，无需插件。</p>
            </div>

            <div class="content-block">
                <h4>WebRTC核心组件</h4>
                <ul>
                    <li><strong>MediaStream</strong>：获取摄像头/麦克风流</li>
                    <li><strong>RTCPeerConnection</strong>：建立P2P连接</li>
                    <li><strong>RTCDataChannel</strong>：传输任意数据</li>
                </ul>
            </div>

            <div class="content-block">
                <h4>WebRTC支持的编解码器</h4>
                <table>
                    <thead>
                        <tr>
                            <th>类型</th>
                            <th>必选</th>
                            <th>可选</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>视频</td>
                            <td>VP8</td>
                            <td>VP9, H.264, AV1</td>
                        </tr>
                        <tr>
                            <td>音频</td>
                            <td>Opus</td>
                            <td>G.711, G.722, AAC</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="info-box">
                <h4>WebRTC应用场景</h4>
                <ul>
                    <li>视频会议：Zoom网页版、Google Meet</li>
                    <li>语音通话：Discord、Web WhatsApp</li>
                    <li>直播互动：弹幕语音、连麦</li>
                    <li>在线教育：实时授课、问答</li>
                </ul>
            </div>
        </section>

        <section class="section">
            <h2>Smooth Streaming - 微软平滑流媒体</h2>
            
            <div class="algorithm-card">
                <h4>协议概述</h4>
                <p>Smooth Streaming是微软开发的自适应流媒体协议，基于IIS Media Services，主要在Microsoft平台使用。</p>
            </div>

            <div class="content-block">
                <h4>Smooth Streaming特点</h4>
                <ul>
                    <li><strong>片段格式</strong>：使用.mp4分片</li>
                    <li><strong>索引文件</strong>：.ismc (Manifest)</li>
                    <li><strong>Fragment</strong>：moof+mdat原子</li>
                </ul>
            </div>

            <div class="info-box warning">
                <h4>Smooth Streaming现状</h4>
                <ul>
                    <li>主要在Windows/Silverlight生态使用</li>
                    <li>逐渐被HLS/DASH取代</li>
                    <li>现在主要通过MSE/EME支持</li>
                </ul>
            </div>
        </section>

        <section class="section">
            <h2>协议对比总结</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>协议</th>
                        <th>类型</th>
                        <th>延迟</th>
                        <th>适用场景</th>
                        <th>浏览器支持</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>HTTP Progressive</strong></td>
                        <td>点播</td>
                        <td>无延迟</td>
                        <td>简单音频播放</td>
                        <td>原生支持</td>
                    </tr>
                    <tr>
                        <td><strong>HLS</strong></td>
                        <td>点播/直播</td>
                        <td>10-30秒</td>
                        <td>Apple生态、视频</td>
                        <td>原生或hls.js</td>
                    </tr>
                    <tr>
                        <td><strong>DASH</strong></td>
                        <td>点播/直播</td>
                        <td>10-30秒</td>
                        <td>YouTube、Netflix</td>
                        <td>MSE原生</td>
                    </tr>
                    <tr>
                        <td><strong>RTMP</strong></td>
                        <td>直播推流</td>
                        <td>2-5秒</td>
                        <td>OBS推流、直播</td>
                        <td>需转码</td>
                    </tr>
                    <tr>
                        <td><strong>WebRTC</strong></td>
                        <td>实时通信</td>
                        <td>&lt; 500ms</td>
                        <td>视频通话、互动直播</td>
                        <td>原生支持</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box">
                <h4>选择建议</h4>
                <ul>
                    <li><strong>音乐点播</strong>：HTTP Progressive 或 HLS</li>
                    <li><strong>音乐直播</strong>：HLS/DASH + 低延迟模式</li>
                    <li><strong>语音通话</strong>：WebRTC</li>
                    <li><strong>互动直播</strong>：WebRTC + HLS回放</li>
                    <li><strong>OBS推流</strong>：RTMP推流，转码HLS播放</li>
                </ul>
            </div>
        </section>

        <section class="section">
            <h2>实际架构示例</h2>
            
            <div class="content-block">
                <h4>关键技术组件</h4>
                <ul>
                    <li><strong>存储层</strong>：OSS/S3存储原始音频文件</li>
                    <li><strong>转码层</strong>：FFmpeg集群，多码率转码</li>
                    <li><strong>分片服务</strong>：HLS/DASH分片生成</li>
                    <li><strong>CDN分发</strong>：全球节点，边缘缓存</li>
                    <li><strong>播放器</strong>：hls.js、dash.js，自适应播放</li>
                    <li><strong>DRM保护</strong>：Widevine/FairPlay/PlayReady</li>
                </ul>
            </div>
        </section>
    </div>

    <a href="#" class="back-to-top">返回顶部</a>
</body>
</html>